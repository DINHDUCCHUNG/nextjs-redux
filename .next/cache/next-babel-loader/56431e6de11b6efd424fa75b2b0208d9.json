{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport fetch from 'isomorphic-unfetch';\n\nconst graphql_middleware = url => {\n  return store => {\n    return next => {\n      return action => {\n        if (typeof action.payload === 'object' && action.payload.query) {\n          // allow call normal action\n          next(action);\n          let headers = {\n            'Content-Type': 'application/json',\n            Accept: 'application/json' // if (localStorage.getItem('token')) headers['token'] = localStorage.getItem('token')\n\n          };\n          fetch(`${url}/graphql`, {\n            method: 'POST',\n            headers,\n            body: _JSON$stringify({\n              query: action.payload.query,\n              variables: {\n                devteam: process.env.NODE_ENV === 'development'\n              }\n            })\n          }).then(r => {\n            console.log('heeheh');\n            return r.json();\n          }).then(data => {\n            const result = data.data;\n\n            for (var key in result) {\n              if (result.hasOwnProperty(key)) {\n                if (result[key].success === false) {\n                  alert(result[key].messages);\n                  store.dispatch({\n                    type: [action.type, key.split(/(?=[A-Z])/).join('_').toUpperCase(), 'FAIL'].join('_'),\n                    messages: result[key].messages,\n                    old_action: action\n                  });\n                } else store.dispatch({\n                  type: [action.type, key.split(/(?=[A-Z])/).join('_').toUpperCase(), 'SUCCESS'].join('_'),\n                  messages: result[key].messages,\n                  data: result[key],\n                  old_action: action\n                });\n              }\n            }\n          }).catch(error => {\n            console.error(error);\n            store.dispatch({\n              type: action.type + '_FAIL',\n              old_action: action\n            });\n          });\n        } else {\n          next(action);\n        }\n      };\n    };\n  };\n};\n\nexport default graphql_middleware;","map":{"version":3,"sources":["/home/pilot/JS/with-redux-thunk-app/middlewares/graphql-middleware.js"],"names":["fetch","graphql_middleware","url","store","next","action","payload","query","headers","Accept","method","body","variables","devteam","process","env","NODE_ENV","then","r","console","log","json","data","result","key","hasOwnProperty","success","alert","messages","dispatch","type","split","join","toUpperCase","old_action","catch","error"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,oBAAlB;;AAEA,MAAMC,kBAAkB,GAAGC,GAAG,IAAI;AAChC,SAAOC,KAAK,IAAI;AACd,WAAOC,IAAI,IAAI;AACb,aAAOC,MAAM,IAAI;AACf,YAAI,OAAOA,MAAM,CAACC,OAAd,KAA0B,QAA1B,IAAsCD,MAAM,CAACC,OAAP,CAAeC,KAAzD,EAAgE;AAC9D;AACAH,UAAAA,IAAI,CAACC,MAAD,CAAJ;AAEA,cAAIG,OAAO,GAAG;AACZ,4BAAgB,kBADJ;AAEZC,YAAAA,MAAM,EAAE,kBAFI,CAKd;;AALc,WAAd;AAMAT,UAAAA,KAAK,CAAE,GAAEE,GAAI,UAAR,EAAmB;AACtBQ,YAAAA,MAAM,EAAE,MADc;AAEtBF,YAAAA,OAFsB;AAGtBG,YAAAA,IAAI,EAAE,gBAAe;AACnBJ,cAAAA,KAAK,EAAEF,MAAM,CAACC,OAAP,CAAeC,KADH;AAEnBK,cAAAA,SAAS,EAAE;AAAEC,gBAAAA,OAAO,EAAEC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB;AAApC;AAFQ,aAAf;AAHgB,WAAnB,CAAL,CAQGC,IARH,CAQQC,CAAC,IAAI;AACTC,YAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AACA,mBAAOF,CAAC,CAACG,IAAF,EAAP;AACD,WAXH,EAYGJ,IAZH,CAYQK,IAAI,IAAI;AACZ,kBAAMC,MAAM,GAAGD,IAAI,CAACA,IAApB;;AACA,iBAAK,IAAIE,GAAT,IAAgBD,MAAhB,EAAwB;AACtB,kBAAIA,MAAM,CAACE,cAAP,CAAsBD,GAAtB,CAAJ,EAAgC;AAC9B,oBAAID,MAAM,CAACC,GAAD,CAAN,CAAYE,OAAZ,KAAwB,KAA5B,EAAmC;AACjCC,kBAAAA,KAAK,CAACJ,MAAM,CAACC,GAAD,CAAN,CAAYI,QAAb,CAAL;AACAzB,kBAAAA,KAAK,CAAC0B,QAAN,CAAe;AACbC,oBAAAA,IAAI,EAAE,CACJzB,MAAM,CAACyB,IADH,EAEJN,GAAG,CACAO,KADH,CACS,WADT,EAEGC,IAFH,CAEQ,GAFR,EAGGC,WAHH,EAFI,EAMJ,MANI,EAOJD,IAPI,CAOC,GAPD,CADO;AASbJ,oBAAAA,QAAQ,EAAEL,MAAM,CAACC,GAAD,CAAN,CAAYI,QATT;AAUbM,oBAAAA,UAAU,EAAE7B;AAVC,mBAAf;AAYD,iBAdD,MAeEF,KAAK,CAAC0B,QAAN,CAAe;AACbC,kBAAAA,IAAI,EAAE,CACJzB,MAAM,CAACyB,IADH,EAEJN,GAAG,CACAO,KADH,CACS,WADT,EAEGC,IAFH,CAEQ,GAFR,EAGGC,WAHH,EAFI,EAMJ,SANI,EAOJD,IAPI,CAOC,GAPD,CADO;AASbJ,kBAAAA,QAAQ,EAAEL,MAAM,CAACC,GAAD,CAAN,CAAYI,QATT;AAUbN,kBAAAA,IAAI,EAAEC,MAAM,CAACC,GAAD,CAVC;AAWbU,kBAAAA,UAAU,EAAE7B;AAXC,iBAAf;AAaH;AACF;AACF,WA9CH,EA+CG8B,KA/CH,CA+CSC,KAAK,IAAI;AACdjB,YAAAA,OAAO,CAACiB,KAAR,CAAcA,KAAd;AAEAjC,YAAAA,KAAK,CAAC0B,QAAN,CAAe;AACbC,cAAAA,IAAI,EAAEzB,MAAM,CAACyB,IAAP,GAAc,OADP;AAEbI,cAAAA,UAAU,EAAE7B;AAFC,aAAf;AAID,WAtDH;AAuDD,SAjED,MAiEO;AACLD,UAAAA,IAAI,CAACC,MAAD,CAAJ;AACD;AACF,OArED;AAsED,KAvED;AAwED,GAzED;AA0ED,CA3ED;;AA6EA,eAAeJ,kBAAf","sourcesContent":["import fetch from 'isomorphic-unfetch'\n\nconst graphql_middleware = url => {\n  return store => {\n    return next => {\n      return action => {\n        if (typeof action.payload === 'object' && action.payload.query) {\n          // allow call normal action\n          next(action)\n\n          let headers = {\n            'Content-Type': 'application/json',\n            Accept: 'application/json'\n          }\n\n          // if (localStorage.getItem('token')) headers['token'] = localStorage.getItem('token')\n          fetch(`${url}/graphql`, {\n            method: 'POST',\n            headers,\n            body: JSON.stringify({\n              query: action.payload.query,\n              variables: { devteam: process.env.NODE_ENV === 'development' }\n            })\n          })\n            .then(r => {\n              console.log('heeheh')\n              return r.json()\n            })\n            .then(data => {\n              const result = data.data\n              for (var key in result) {\n                if (result.hasOwnProperty(key)) {\n                  if (result[key].success === false) {\n                    alert(result[key].messages)\n                    store.dispatch({\n                      type: [\n                        action.type,\n                        key\n                          .split(/(?=[A-Z])/)\n                          .join('_')\n                          .toUpperCase(),\n                        'FAIL'\n                      ].join('_'),\n                      messages: result[key].messages,\n                      old_action: action\n                    })\n                  } else\n                    store.dispatch({\n                      type: [\n                        action.type,\n                        key\n                          .split(/(?=[A-Z])/)\n                          .join('_')\n                          .toUpperCase(),\n                        'SUCCESS'\n                      ].join('_'),\n                      messages: result[key].messages,\n                      data: result[key],\n                      old_action: action\n                    })\n                }\n              }\n            })\n            .catch(error => {\n              console.error(error)\n\n              store.dispatch({\n                type: action.type + '_FAIL',\n                old_action: action\n              })\n            })\n        } else {\n          next(action)\n        }\n      }\n    }\n  }\n}\n\nexport default graphql_middleware\n"]},"metadata":{},"sourceType":"module"}